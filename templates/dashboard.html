<!DOCTYPE html>
<html lang="en" data-bs-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="auth-check" content="true">
    <title>Gambit Admin - Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Authentication check
        document.addEventListener('DOMContentLoaded', function() {
            const authToken = localStorage.getItem('authToken');
            if (!authToken) {
                // Redirect to login page if no auth token is found
                window.location.href = '/login';
            } else {
                // Add the token to all future API requests
                document.token = authToken;

                // Set up an interceptor to add the Authorization header to all fetch requests
                const originalFetch = window.fetch;
                window.fetch = function(url, options = {}) {
                    if (!options.headers) {
                        options.headers = {};
                    }
                    options.headers['Authorization'] = `Bearer ${authToken}`;
                    return originalFetch(url, options);
                };

                // Add Authorization header to current page
                const xhr = new XMLHttpRequest();
                xhr.open('GET', window.location.href, true);
                xhr.setRequestHeader('Authorization', `Bearer ${authToken}`);
                xhr.send();
            }
        });
    </script>
    <style>
        body {
            background-color: #0f0a19;
            color: #fff;
        }
        .sidebar {
            background-color: #1a1225;
            min-height: 100vh;
            padding: 20px;
        }
        .main-content {
            padding: 20px;
        }
        .nav-link {
            color: #a099ad;
            padding: 10px 15px;
            margin: 5px 0;
            border-radius: 8px;
        }
        .nav-link:hover, .nav-link.active {
            background-color: #2d1f42;
            color: #fff;
        }
        .card {
            background-color: #1a1225;
            border: none;
            border-radius: 12px;
        }
        .stats-card {
            background-color: #1a1225;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
        .stats-number {
            font-size: 24px;
            font-weight: bold;
            color: #fff;
        }
        .chart-container {
            background-color: #1a1225;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="row">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <h3 class="mb-4">Gambit</h3>
                <div class="nav flex-column">
                    <a href="#" class="nav-link active">Dashboard</a>
                    <a href="#" class="nav-link">Manage Leagues</a>
                    <a href="#" class="nav-link">Manage Users</a>
                    <a href="#" class="nav-link">View Subscription</a>
                    <a href="#" class="nav-link">Manage Reels</a>
                    <a href="#" class="nav-link">Manage Notification</a>
                    <a href="#" class="nav-link">Manage Content</a>
                    <a href="#" class="nav-link">Manage Roles</a>
                </div>
            </div>

            <!-- Main Content -->
            <div class="col-md-10 main-content">
                <div class="d-flex justify-content-between align-items-center mb-4">
                    <h2>Dashboard</h2>
                    <div class="user-info">
                        <span id="userName">Loading...</span>
                    </div>
                </div>

                <!-- Subscribers Overview -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="chart-container">
                            <h4>Subscribers Overview</h4>
                            <canvas id="subscribersChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Stats Row -->
                <div class="row mb-4">
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h5>Total No. of Subscribers</h5>
                            <div class="stats-number" id="totalSubscribers">Loading...</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h5>Monthly</h5>
                            <div class="stats-number" id="monthlySubscribers">Loading...</div>
                        </div>
                    </div>
                    <div class="col-md-4">
                        <div class="stats-card">
                            <h5>Yearly</h5>
                            <div class="stats-number" id="yearlySubscribers">Loading...</div>
                        </div>
                    </div>
                </div>

                <!-- Users Stats -->
                <div class="row mb-4">
                    <div class="col-12">
                        <div class="chart-container">
                            <h4>Users Stats</h4>
                            <canvas id="usersChart"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Popular Content -->
                <div class="row">
                    <div class="col-md-6">
                        <div class="stats-card">
                            <h5>Most Viewed League</h5>
                            <div id="mostViewedLeague">Loading...</div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="stats-card">
                            <h5>Most Viewed Team</h5>
                            <div id="mostViewedTeam">Loading...</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Fetch dashboard data
        async function fetchDashboardData() {
            const response = await fetch('/api/dashboard/');
            const data = await response.json();
            return data.data;
        }

        // Initialize charts and populate data
        async function initializeDashboard() {
            const data = await fetchDashboardData();

            // Update subscriber stats
            document.getElementById('totalSubscribers').textContent = data.subscribers.total;
            document.getElementById('monthlySubscribers').textContent = data.subscribers.monthly;
            document.getElementById('yearlySubscribers').textContent = data.subscribers.yearly;

            // Update popular content
            document.getElementById('mostViewedLeague').textContent = data.popular_content.most_viewed_league.name;
            document.getElementById('mostViewedTeam').textContent = data.popular_content.most_viewed_team.name;

            // Initialize Subscribers Chart
            const monthLabels = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            new Chart(document.getElementById('subscribersChart'), {
                type: 'bar',
                data: {
                    labels: monthLabels,
                    datasets: [
                        {
                            label: 'Monthly',
                            data: Array(12).fill(data.subscribers.monthly / 12),
                            backgroundColor: '#36A2EB'
                        },
                        {
                            label: 'Yearly',
                            data: Array(12).fill(data.subscribers.yearly / 12),
                            backgroundColor: '#FF6384'
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#2d1f42'
                            }
                        },
                        x: {
                            grid: {
                                color: '#2d1f42'
                            }
                        }
                    }
                }
            });

            // Initialize Users Chart
            const userActivity = data.user_activity || [];
            new Chart(document.getElementById('usersChart'), {
                type: 'line',
                data: {
                    labels: userActivity.map(item => item.date),
                    datasets: [
                        {
                            label: 'Active Users',
                            data: userActivity.map(item => item.active_users),
                            borderColor: '#FF6384',
                            tension: 0.4,
                            fill: false
                        },
                        {
                            label: 'New Users',
                            data: userActivity.map(item => item.new_users),
                            borderColor: '#36A2EB',
                            tension: 0.4,
                            fill: false
                        }
                    ]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#2d1f42'
                            }
                        },
                        x: {
                            grid: {
                                color: '#2d1f42'
                            }
                        }
                    }
                }
            });
        }

        // Initialize the dashboard when the page loads
        document.addEventListener('DOMContentLoaded', initializeDashboard);
    </script>
</body>
</html>
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard - Gambit Admin</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-[#0A061D] text-white">
    <div class="p-8">
        <h1 class="text-2xl mb-8">Dashboard</h1>

        <!-- Subscribers Overview -->
        <div class="mb-8">
            <h2 class="text-xl mb-4">Subscribers Overview</h2>
            <div class="grid grid-cols-3 gap-4">
                <div class="bg-[#1A1630] p-4 rounded">
                    <h3>Total Subscribers</h3>
                    <p id="totalSubs" class="text-2xl"></p>
                </div>
                <div class="bg-[#1A1630] p-4 rounded">
                    <h3>Monthly</h3>
                    <p id="monthlySubs" class="text-2xl"></p>
                </div>
                <div class="bg-[#1A1630] p-4 rounded">
                    <h3>Yearly</h3>
                    <p id="yearlySubs" class="text-2xl"></p>
                </div>
            </div>
            <canvas id="subscribersChart" class="mt-4 bg-[#1A1630] p-4 rounded"></canvas>
        </div>

        <!-- Users Stats -->
        <div class="mb-8">
            <h2 class="text-xl mb-4">Users Stats</h2>
            <canvas id="usersChart" class="bg-[#1A1630] p-4 rounded"></canvas>
        </div>

        <!-- Popular Content -->
        <div class="grid grid-cols-2 gap-4">
            <div class="bg-[#1A1630] p-4 rounded">
                <h2 class="text-xl mb-4">Most Viewed League</h2>
                <div id="mostViewedLeague"></div>
            </div>
            <div class="bg-[#1A1630] p-4 rounded">
                <h2 class="text-xl mb-4">Most Viewed Team</h2>
                <div id="mostViewedTeam"></div>
            </div>
        </div>
    </div>

    <script>
        async function fetchDashboardData() {
            const token = localStorage.getItem('authToken');
            const response = await fetch('/api/dashboard/', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            const data = await response.json();
            return data.data;
        }

        async function initDashboard() {
            const data = await fetchDashboardData();

            // Update subscriber counts
            document.getElementById('totalSubs').textContent = data.subscribers.total;
            document.getElementById('monthlySubs').textContent = data.subscribers.monthly;
            document.getElementById('yearlySubs').textContent = data.subscribers.yearly;

            // Update most viewed content
            document.getElementById('mostViewedLeague').textContent = data.popular_content.most_viewed_league.name;
            document.getElementById('mostViewedTeam').textContent = data.popular_content.most_viewed_team.name;

            // Initialize charts
            initSubscribersChart(data.user_activity);
            initUsersChart(data.user_activity);
        }

        function initSubscribersChart(data) {
            const ctx = document.getElementById('subscribersChart').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [{
                        label: 'Monthly Subscribers',
                        data: data.map(d => d.monthly_subscribers),
                        backgroundColor: '#36A2EB'
                    }, {
                        label: 'Yearly Subscribers',
                        data: data.map(d => d.yearly_subscribers),
                        backgroundColor: '#FF6384'
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#2D2D2D'
                            }
                        },
                        x: {
                            grid: {
                                color: '#2D2D2D'
                            }
                        }
                    }
                }
            });
        }

        function initUsersChart(data) {
            const ctx = document.getElementById('usersChart').getContext('2d');
            new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [{
                        label: 'Active Users',
                        data: data.map(d => d.active_users),
                        borderColor: '#FF6384',
                        tension: 0.4
                    }, {
                        label: 'New Users',
                        data: data.map(d => d.new_users),
                        borderColor: '#36A2EB',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                color: '#2D2D2D'
                            }
                        },
                        x: {
                            grid: {
                                color: '#2D2D2D'
                            }
                        }
                    }
                }
            });
        }

        initDashboard();
    </script>
</body>
</html>